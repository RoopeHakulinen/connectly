<div class="dashboard-container">
  <h1>{{ 'DASHBOARD.TITLE' | translate }}</h1>

  @if (upcomingTargets$ | async; as query) {
    @if (query.isLoading) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    } @else if (query.data) {
      @if (query.data.length === 0) {
        <div class="empty-state">
          <mat-icon>event_available</mat-icon>
          <p>{{ 'DASHBOARD.EMPTY.TITLE' | translate }}</p>
        </div>
      } @else {
        <div class="cards-grid">
          @for (target of query.data; track target.id) {
            <mat-card [class.overdue]="target.isOverdue" class="clickable" (click)="openRecordActivityDialog(target)">
              <mat-card-header>
                <div mat-card-avatar class="avatar" [style.background-color]="getAvatarColor(target.name)">
                  {{ getInitials(target.name) }}
                </div>
                <mat-card-title>{{ target.name }}</mat-card-title>
                <mat-card-subtitle>
                  <mat-chip-set>
                    <mat-chip [highlighted]="target.isOverdue" [matTooltip]="formatDeadline(target.deadline)">
                      {{ getRelativeDeadline(target) }}
                    </mat-chip>
                  </mat-chip-set>
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                @if (target.lastActivity) {
                  <p class="last-activity">
                    <mat-icon>history</mat-icon>
                    {{ 'DASHBOARD.CARD.LAST_CONTACT' | translate }} {{ target.lastActivity | date:'mediumDate' }}
                  </p>
                } @else {
                  <p class="last-activity no-activity">
                    <mat-icon>warning</mat-icon>
                    {{ 'DASHBOARD.CARD.NO_CONTACT' | translate }}
                  </p>
                }
                @if (target.notes) {
                  <p class="notes">{{ target.notes }}</p>
                }
              </mat-card-content>
            </mat-card>
          }
        </div>
      }
    }
  }
</div>
