<div class="page-container">
  <div class="header">
    <div>
      <h1>{{ 'TARGETS.TITLE' | translate }}</h1>
      <p class="subtitle">{{ 'TARGETS.SUBTITLE' | translate }}</p>
    </div>
    <button mat-flat-button color="primary" (click)="openDialog()">
      <mat-icon>add</mat-icon>
      {{ 'TARGETS.NEW' | translate }}
    </button>
  </div>

  @if (targets$ | async; as query) {
  @if (query.isLoading) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
  } @else if (query.data) {
  @if (query.data.length === 0) {
  <div class="empty-state">
    <mat-icon>list</mat-icon>
    <p>{{ 'TARGETS.EMPTY' | translate }}</p>
  </div>
  } @else {
  <div class="cards-grid">
    @for (target of query.data; track target.id) {
    <mat-card>
      <mat-card-header>
        <div mat-card-avatar class="avatar" [style.background-color]="getAvatarColor(target.name)">
          {{ getInitials(target.name) }}
        </div>
        <mat-card-title>{{ target.name }}</mat-card-title>
        <mat-card-subtitle>
          {{ target.tier.interval | recurrence | async }}
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        @if (target.notes) {
        <p class="notes">{{ target.notes }}</p>
        } @else {
        <p class="notes italic">{{ 'TARGETS.NO_NOTES' | translate }}</p>
        }
      </mat-card-content>
      <mat-card-actions align="end">
        <button mat-button [routerLink]="['/app/targets', target.id]">{{ 'COMMON.VIEW' | translate }}</button>
        <button mat-button (click)="openDialog(target)">{{ 'COMMON.EDIT' | translate }}</button>
        <button mat-button color="warn" (click)="delete(target)">
          {{ 'COMMON.DELETE' | translate }}
        </button>
      </mat-card-actions>
    </mat-card>
    }
  </div>
  }
  }
  }
</div>